<?xml version="1.0" encoding="UTF-8"?><record_update sys_domain="global" table="sys_cb_design_topic">
    <sys_cb_design_topic action="INSERT_OR_UPDATE">
        <compiled_topic display_value="">fd157f584fb7a300209b4a318110c721</compiled_topic>
        <design_definition>{"type":"FlowTopic","triggers":[{"type":"Trigger","name":"5eed789d22964ba68cb99aefda259870","triggerType":"request","applicability":{"type":"Applicability","mode":"script","value":""},"id":"5eed789d22964ba68cb99aefda259870"}],"goals":[{"name":"Catalog Item Search","trigger_id":"5eed789d22964ba68cb99aefda259870","nodes":[{"type":"StartGoal","goal_id":"aeda8cc701634008bdec66df98ac29d3","greeting_msg":{"type":"String","mode":"string","value":""},"id":"926c4eb51e7d43eab3583e2d76db262a","name":"Start"},{"type":"TerminateGoal","goal_id":"aeda8cc701634008bdec66df98ac29d3","confirmation_msg":{"type":"String","mode":"string","value":""},"id":"26f0dd259235411c84059d9d654dfe44","name":"End"},{"type":"CarouselInputPrompt","carousel_options_script":"(function execute() {\n    var results = JSON.parse(vaVars.results);\n    var baseURL = gs.getProperty('glide.servlet.uri');\n    var options = [];\n    for (var i=0; i&lt; results.length; i++) {\n        options.push(\n            {\n                'Name': results[i].title,\n                'Value': i + '',\n                'Body': baseURL + '/' + results[i].image\n            }\n        );\n    }\n    return options;\n})()\n","no_options_found_message":{"type":"String","mode":"string","value":"gs.getMessage(\"No Records Found\")"},"id":"6b36a4cc35ce4a349ef3f3f7b045ff15","name":"Catalog Item","goal_id":"aeda8cc701634008bdec66df98ac29d3","variable_id":"df40202c28f7441fa2e380a40ef2fe75","message":{"type":"String","mode":"string","value":"gs.getMessage(\"Here’s what I have available.  You'll have a chance to confirm or cancel the order next.\")"},"optional":false},{"type":"InputPrompt","variable_id":"d6c419c989004fd4bbb6e8e7bfdac57b","message":{"type":"String","mode":"string","value":"gs.getMessage(\"Please enter a short description of what you're looking for.\")"},"optional":false,"id":"84c135ea9d854c3fb993f48381575b34","name":"Search Term","goal_id":"aeda8cc701634008bdec66df98ac29d3"},{"type":"ScriptedAction","script":"(function execute() {\n    var search_term = vaInputs.search_term;\n    var context = '6f7e3f565b30130070e4492c11f91aea';\n\n    var contextualSearch = new sn_itsm_va.VAContextualSearchUtil();\n    var response = contextualSearch.search(context, search_term);\n\n    var success = contextualSearch.processSearchResponse(response);\n    if (!success) {\n        vaVars.count = 0;\n        return '';\n    }\n\n    //Filter out any catalog items that should not be shown ie. Record Producers\n    //create a filterMap to quickly see if item can be shown to user\n    var filter_tables = vaVars.filter_tables.split(',');\n    var filterMap = {};\n    for (var i=0; i &lt; filter_tables.length; i++) {\n        filterMap[filter_tables[i]] = 'true';\n    }\n\n    var searchResults = response.results;\n    var results = [];\n    var count = 0;\n    for (var index=0; index &lt; searchResults.length &amp;&amp; count &lt; parseInt(vaVars.limit); index++) {\n        //Get sys_id of search result\n        var sys_id = searchResults[index].id.split(':')[1];\n        //Lookup item to find the tableName\n        var gr = new GlideRecord('sc_cat_item');\n        if (gr.get(sys_id)) {\n            var tableName = gr.getValue('sys_class_name');\n            //if the tableName is not found in filterMap, we can show it to user\n            if (filterMap[tableName] == undefined) {\n                results.push({\n                    'sys_id': sys_id,\n                    'title': searchResults[index].title,\n                    'image': searchResults[index].image.link\n                });\n                count++;\n            }\n        }\n    }\n\n    vaVars.count = results.length;\n    vaVars.results = JSON.stringify(results);\n\n    return '';\n})()\n","id":"d0e83486a7224a84b6fefd8ad2563e55","name":"Contextual Search","goal_id":"aeda8cc701634008bdec66df98ac29d3"},{"type":"Decision","name":"Decision","branches":[{"type":"Branch","label":"More than One Item","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return parseInt(vaVars.count) &gt; 1;\n})()\n"},"id":"56c28ed03b8248c28684dad7de0cfbf7","name":"More than One Item"},{"type":"Branch","label":"Only One Item","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return parseInt(vaVars.count) == 1;\n})()\n"},"id":"626f63957f004f64a014e3d512f6ad9e","name":"Only One Item"},{"type":"Branch","label":"No Items Exist","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return parseInt(vaVars.count) == 0;\n})()\n"},"id":"3d27842a39564df3b9648029abd55cca","name":"No Items Exist"}],"id":"5409fc1312f64cb880e3d83297daf071","goal_id":"aeda8cc701634008bdec66df98ac29d3"},{"type":"Decision","name":"Decision","branches":[{"type":"Branch","label":"Try Again","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return vaInputs.search_again.getValue();\n})()\n"},"id":"812862fb43884b8e8234d6c30b00524e","name":"Try Again"},{"type":"Branch","label":"Cancel","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return !vaInputs.search_again.getValue();\n})()\n"},"id":"d0e28fb6b45d4946a5074a03ed2729da","name":"Cancel"}],"id":"424cae885d054165a4c21619df57ae00","goal_id":"aeda8cc701634008bdec66df98ac29d3"},{"type":"ImageOutputPrompt","url":{"type":"String","mode":"script","value":"(function execute() {\n    var results = JSON.parse(vaVars.results);\n    var baseURL = gs.getProperty('glide.servlet.uri');\n    return baseURL + '/' + results[0].image;\n})()\n"},"id":"3a15940a10ea4f309eca39c47d67f3c7","name":"Item Image","goal_id":"aeda8cc701634008bdec66df98ac29d3"},{"type":"ScriptedAction","script":"(function execute() {\n    var results = JSON.parse(vaVars.results);\n    var index = 0;\n    if (parseInt(vaVars.count) &gt; 1) {\n        index = parseInt(vaInputs.catalog_item);\n    }\n    vaVars.selected_title = results[index].title;\n    vaVars.selected_link = gs.getProperty('sn_itsm_va.com.snc.itsm.virtualagent.portal_url') + \n        '?id=sc_cat_item&amp;sys_id=' + results[index].sys_id;\n    return '';\n})()\n","id":"b8322457b0a944fc8f98d67a844b28f0","name":"Set Selected Item","goal_id":"aeda8cc701634008bdec66df98ac29d3"},{"type":"Decision","name":"Decision","branches":[{"type":"Branch","label":"Image Exists","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    var results = JSON.parse(vaVars.results);\n    return (results[0].image != '');\n})()\n"},"id":"ec8c210dc66a4f9c8227b741fc9a8881","name":"Image Exists"},{"type":"Branch","label":"No Image","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    var results = JSON.parse(vaVars.results);\n    return (results[0].image == '');\n})()\n"},"id":"e99ceef199094974b052a958426e202f","name":"No Image"}],"id":"555d568fb4fc4e9bb892526e3c3bc37c","goal_id":"aeda8cc701634008bdec66df98ac29d3"},{"type":"OutputPrompt","value":{"type":"String","mode":"string","value":"gs.getMessage(\"Sorry, but I couldn’t find any relevant items.\")"},"id":"9090453a602b4865bca4a2418f33be66","name":"No Items Found","goal_id":"aeda8cc701634008bdec66df98ac29d3"},{"type":"InputPrompt","variable_id":"8fdb2735327a4703a0bc62b336abe11c","message":{"type":"String","mode":"string","value":"gs.getMessage(\"Would you like to search for something else?\")"},"optional":false,"id":"e3d81c7f68774897bf197d104f97739a","name":"Search Again","goal_id":"aeda8cc701634008bdec66df98ac29d3"},{"type":"LinkOutputPrompt","header":{"type":"String","mode":"script","value":"(function execute() {\n    if (parseInt(vaVars.count) == 1)\n        return gs.getMessage('The only item I found is {0}.', vaVars.selected_title);\n\n    return question = gs.getMessage('OK, you chose {0}.', vaVars.selected_title);\n})()\n"},"label":{"type":"String","mode":"string","value":"gs.getMessage(\"Order your item here.\")"},"url":{"type":"String","mode":"script","value":"(function execute() {\n    return gs.getProperty('glide.servlet.uri') + '/' + vaVars.selected_link;\n})()\n"},"id":"54431136e0e54e2dba58091b44c803f4","name":"Link Output","goal_id":"aeda8cc701634008bdec66df98ac29d3"},{"type":"OutputPrompt","value":{"type":"String","mode":"string","value":"gs.getMessage(\"Thanks for using our support chat! Have a great day!\")"},"id":"c4a7926446a24c9e8625728a06bd4395","name":"Acknowledgement","goal_id":"aeda8cc701634008bdec66df98ac29d3"}],"edges":[{"type":"Edge","source_node_id":"9090453a602b4865bca4a2418f33be66","target_node_id":"e3d81c7f68774897bf197d104f97739a","id":"e614527ba2d14b1987c877d6d55fd90c"},{"type":"Edge","source_node_id":"424cae885d054165a4c21619df57ae00","target_node_id":"84c135ea9d854c3fb993f48381575b34","branch_id":"812862fb43884b8e8234d6c30b00524e","id":"a5e8257579594986a162ff5d9e2ad2c1","name":"812862fb43884b8e8234d6c30b00524e"},{"type":"Edge","source_node_id":"6b36a4cc35ce4a349ef3f3f7b045ff15","target_node_id":"b8322457b0a944fc8f98d67a844b28f0","id":"135fa67ba3e241c5800b435d842ac766"},{"type":"Edge","source_node_id":"926c4eb51e7d43eab3583e2d76db262a","target_node_id":"84c135ea9d854c3fb993f48381575b34","id":"dec998a3ce7c47768ea1768d9f33fb5d"},{"type":"Edge","source_node_id":"84c135ea9d854c3fb993f48381575b34","target_node_id":"d0e83486a7224a84b6fefd8ad2563e55","id":"d97e655d60a7450b98c89aef05bb9480"},{"type":"Edge","source_node_id":"d0e83486a7224a84b6fefd8ad2563e55","target_node_id":"5409fc1312f64cb880e3d83297daf071","id":"be69565caa5f4b409f6e99e6cc207933"},{"type":"Edge","source_node_id":"5409fc1312f64cb880e3d83297daf071","target_node_id":"6b36a4cc35ce4a349ef3f3f7b045ff15","branch_id":"56c28ed03b8248c28684dad7de0cfbf7","id":"5c3d8c051dfa475d8d5376433fafd120","name":"56c28ed03b8248c28684dad7de0cfbf7"},{"type":"Edge","source_node_id":"3a15940a10ea4f309eca39c47d67f3c7","target_node_id":"b8322457b0a944fc8f98d67a844b28f0","id":"c171ff4b8fd4490f8a0484f932243218"},{"type":"Edge","source_node_id":"5409fc1312f64cb880e3d83297daf071","target_node_id":"555d568fb4fc4e9bb892526e3c3bc37c","branch_id":"626f63957f004f64a014e3d512f6ad9e","id":"6f1b535c6a39418886069d1fe21e4fb0","name":"626f63957f004f64a014e3d512f6ad9e"},{"type":"Edge","source_node_id":"555d568fb4fc4e9bb892526e3c3bc37c","target_node_id":"3a15940a10ea4f309eca39c47d67f3c7","branch_id":"ec8c210dc66a4f9c8227b741fc9a8881","id":"b61378c459624d4d9eea3dbeb0c05b6d","name":"ec8c210dc66a4f9c8227b741fc9a8881"},{"type":"Edge","source_node_id":"555d568fb4fc4e9bb892526e3c3bc37c","target_node_id":"b8322457b0a944fc8f98d67a844b28f0","branch_id":"e99ceef199094974b052a958426e202f","id":"d76835ddd08f4ea1b8ba06c829926ca8","name":"e99ceef199094974b052a958426e202f"},{"type":"Edge","source_node_id":"5409fc1312f64cb880e3d83297daf071","target_node_id":"9090453a602b4865bca4a2418f33be66","branch_id":"3d27842a39564df3b9648029abd55cca","id":"9b72e2071b734e9c8040093282a84c06","name":"3d27842a39564df3b9648029abd55cca"},{"type":"Edge","source_node_id":"e3d81c7f68774897bf197d104f97739a","target_node_id":"424cae885d054165a4c21619df57ae00","id":"4b8d3908c52f4a2c82f9036921d76bf2"},{"type":"Edge","source_node_id":"b8322457b0a944fc8f98d67a844b28f0","target_node_id":"54431136e0e54e2dba58091b44c803f4","id":"b4981b8580d343ccaff6a37e566f0856"},{"type":"Edge","source_node_id":"54431136e0e54e2dba58091b44c803f4","target_node_id":"e3d81c7f68774897bf197d104f97739a","id":"0e5d02820d174739ba3ae0a3f52b1136"},{"type":"Edge","source_node_id":"424cae885d054165a4c21619df57ae00","target_node_id":"c4a7926446a24c9e8625728a06bd4395","branch_id":"d0e28fb6b45d4946a5074a03ed2729da","id":"c6615a01f37a4ccf91fb63b04c21ed5b","name":"d0e28fb6b45d4946a5074a03ed2729da"},{"type":"Edge","source_node_id":"c4a7926446a24c9e8625728a06bd4395","target_node_id":"26f0dd259235411c84059d9d654dfe44","id":"e53e2bd9617d4a11b305b518dd7f4f15"}],"id":"aeda8cc701634008bdec66df98ac29d3"}],"script_variables":[{"type":"String","name":"limit","value":{"type":"String","mode":"string","value":"5"},"id":"d388ef5d90f246eb903bc3eedddf19b0"},{"type":"String","name":"count","value":{"type":"String","mode":"string","value":"0"},"id":"05592aa5c39b4401803d25e9eeb61704"},{"type":"String","name":"results","id":"e57b8b4161ad4c6aa4ee351bb3ec347f"},{"type":"String","name":"selected_title","id":"a5be7f315b8642648ae673efa2a55442"},{"type":"String","name":"selected_link","id":"ad2197b0ad1747588387b723f798885e"},{"type":"String","name":"filter_tables","value":{"type":"String","mode":"string","value":"sc_cat_item_content,sc_cat_item_producer,sc_cat_item_wizard,std_change_record_producer,sc_cat_item_producer_service"},"id":"8ec78df4d1f14c3b9bb2bff47c91b6cd"},{"type":"String","name":"LiveAgent_application","value":{"type":"String","mode":"string","value":"itsm"},"id":"9f0f29d1bbec47c08b443f6e2254b1db"}],"glide_variables":[{"type":"CarouselImage","id":"df40202c28f7441fa2e380a40ef2fe75","name":"catalog_item"},{"type":"String","name":"search_term","id":"d6c419c989004fd4bbb6e8e7bfdac57b"},{"type":"True/False","id":"8fdb2735327a4703a0bc62b336abe11c","name":"search_again"}],"applicability":{"type":"Applicability","mode":"script","value":""},"roles":[],"scope":"134450a0b3781300787162ac16a8dc1e","id":"375155b0db3453005dd0dfea5e961934","name":"Order an Item","key_phrases":["request","buy","item","catalog","purchase","order","computer","phone","need","require"]}</design_definition>
        <design_topic_id>375155b0db3453005dd0dfea5e961934</design_topic_id>
        <name>Order an Item</name>
        <sys_class_name>sys_cb_design_topic</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2019-02-19 17:00:55</sys_created_on>
        <sys_domain>global</sys_domain>
        <sys_id>f915b3984fb7a300209b4a318110c7d4</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name>FlowTopic</sys_name>
        <sys_package display_value="app" source="x_93700_apdc">8472deb0db01230055552bfa4b961970</sys_package>
        <sys_policy/>
        <sys_scope display_value="app">8472deb0db01230055552bfa4b961970</sys_scope>
        <sys_update_name>sys_cb_design_topic_f915b3984fb7a300209b4a318110c7d4</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2019-02-19 17:00:55</sys_updated_on>
        <type>FlowTopic</type>
    </sys_cb_design_topic>
</record_update>
