<?xml version="1.0" encoding="UTF-8"?><record_update sys_domain="global" table="sys_cb_design_topic">
    <sys_cb_design_topic action="INSERT_OR_UPDATE">
        <compiled_topic display_value="Open IT Ticket">945624404f9f2300209b4a318110c722</compiled_topic>
        <design_definition>{"type":"FlowTopic","triggers":[{"type":"Trigger","name":"6861d52e30664d188d2066325828ec42","triggerType":"request","applicability":{"type":"Applicability","mode":"script","value":""},"id":"6861d52e30664d188d2066325828ec42"}],"goals":[{"name":"Create Incident","trigger_id":"6861d52e30664d188d2066325828ec42","nodes":[{"type":"StartGoal","goal_id":"23ce83c5e0e048c7826d8f2f4dfd3fe6","greeting_msg":{"type":"String","mode":"string","value":""},"id":"6d719a50025442d89bfc6bcc0ea097f5","name":"Start"},{"type":"TerminateGoal","goal_id":"23ce83c5e0e048c7826d8f2f4dfd3fe6","confirmation_msg":{"type":"String","mode":"string","value":"gs.getMessage(\"Thanks for using our support chat! Have a great day!\")"},"id":"aa32c52a30c74e7e90a943a52dc1434d","name":"End"},{"type":"InputPrompt","variable_id":"99259e34c31840c5941daa3fb26ceb8d","message":{"type":"String","mode":"string","value":"gs.getMessage(\"Please enter a short description of your issue.\")"},"optional":false,"id":"b3c273f4363e4da0bbdae7a4a49260c2","name":"Short Description","goal_id":"23ce83c5e0e048c7826d8f2f4dfd3fe6"},{"type":"ScriptOutputPrompt","output_type":"single_part","id":"a476dd02b50e49f99eb2d68ace202aaf","name":"Contextual Search","goal_id":"23ce83c5e0e048c7826d8f2f4dfd3fe6","value":{"type":"String","mode":"string","value":"(function execute() {\n    var search_term = vaInputs.short_description;\n    var context = '2821675a5b30130070e4492c11f91a89';\n\n    var contextualSearch = new sn_itsm_va.VAContextualSearchUtil();\n    var response = contextualSearch.search(context, search_term);\n\n    var success = contextualSearch.processSearchResponse(response);\n    if (!success) {\n        vaVars.count = 0;\n        return '';\n    }\n\n    var relevantSearchResults = contextualSearch.processGeneralResults(response, vaVars.limit, 0);\n    vaVars.count = relevantSearchResults.length;\n    if (vaVars.count == 0) {\n        return '';\n    }\n\n    var htmlhead =  gs.getMessage(\"OK. Before creating your incident, here are some KB articles that may help.\") +\n                \"\\r\\n &lt;table style=\\\"width: 100%;\\\"&gt;\\r\\n \" + \n                \"&lt;col width=\\\"33%\\\"&gt;\\r\\n \" +\n                \"&lt;col width=\\\"67%\\\"&gt;\\r\\n\" + \n                \"&lt;tr&gt;\\r\\n\\t&lt;td&gt;&lt;b&gt;\" + gs.getMessage('KB Number') + \"&lt;/b&gt;&lt;/td&gt;\\r\\n  \" + \n                \"\\t&lt;td&gt;&lt;b&gt;\" + gs.getMessage('Short Description') + \"&lt;/b&gt;&lt;/td&gt;\\r\\n&lt;/tr&gt;\";\n    var htmlline =  \"&lt;tr style=\\\"vertical-align:top\\\"&gt;\\r\\n\\t&lt;td&gt;&lt;a target=\\\"_blank\\\" \"+ \n                    \"href=\\\"###LINK###\\\"&gt;\" +\n                    \"###NUMBER###&lt;/a&gt;&lt;/td&gt;\\r\\n\\t&lt;td&gt;###TITLE###&lt;/td&gt;\\r\\n&lt;/tr&gt;\";\n    var htmltail = \"&lt;/table&gt;\";\n\n    var htmlbuilder = \"\" + htmlhead;\n    for (var i = 0; i &lt; vaVars.count; i++) {\n        var sysId = relevantSearchResults[i].id.split(':')[1];\n        htmlbuilder += \n            htmlline.replace(\"###LINK###\",  gs.getProperty('glide.servlet.uri') + '/' +\n                        gs.getProperty('sn_itsm_va.com.snc.itsm.virtualagent.portal_url') +\n                        '?id=kb_article&amp;sys_id=' + sysId)\n                    .replace(\"###NUMBER###\", relevantSearchResults[i].meta.number)\n                    .replace(\"###TITLE###\", relevantSearchResults[i].title);\n        \n    }\n    htmlbuilder += htmltail;\n    \n    return htmlbuilder;\n})()\n"}},{"type":"Decision","name":"Decision","branches":[{"type":"Branch","label":"Has Results","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return (parseInt(vaVars.count) != 0);\n})()\n"},"id":"4d74334d1f684a9ab56612041aa2bb8b","name":"Has Results"},{"type":"Branch","label":"No Results","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return (parseInt(vaVars.count) == 0);\n})()\n"},"id":"455a5667c0f944079782b0e7aa5837db","name":"No Results"}],"id":"dbd8a602ed0240e5aeac72d801953ace","goal_id":"23ce83c5e0e048c7826d8f2f4dfd3fe6"},{"type":"InputPrompt","variable_id":"f114636f04cb414c82416778b2432215","message":{"type":"String","mode":"script","value":"(function execute() {\n    if (vaVars.total_results == 1) {\n        return gs.getMessage('Did this KB article resolve your issue?');\n    }\n    return gs.getMessage('Did any of these articles resolve your issue?');\n})()\n"},"optional":false,"id":"42a895b6306548429858417b21d5bf53","name":"Is Helpful","goal_id":"23ce83c5e0e048c7826d8f2f4dfd3fe6"},{"type":"Decision","name":"Decision","branches":[{"type":"Branch","label":"Helpful","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return vaInputs.is_helpful.getValue();\n})()\n"},"id":"7471736ba6d94461ad0a3e75243c7531","name":"Helpful"},{"type":"Branch","label":"Not Helpful","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return !vaInputs.is_helpful.getValue();\n})()\n"},"id":"64203bf43bfd4c6b92fb4ac2ba15b132","name":"Not Helpful"}],"id":"09aea3c778884e73b41e5f758dd41e29","goal_id":"23ce83c5e0e048c7826d8f2f4dfd3fe6"},{"type":"OutputPrompt","value":{"type":"String","mode":"string","value":"gs.getMessage(\"Alright, I've opened your incident and a technician will be assigned. \")"},"id":"8d97018a18c04e7c838d64371a3b0be0","name":"Acknowledgement","goal_id":"23ce83c5e0e048c7826d8f2f4dfd3fe6"},{"type":"ScriptOutputPrompt","output_type":"single_part","id":"e0ffe80c32bb4b79a36c804329175121","name":"Incident Card","goal_id":"23ce83c5e0e048c7826d8f2f4dfd3fe6","value":{"type":"String","mode":"string","value":"(function execute() {\n      var incident = new GlideRecordSecure('incident');\n      incident.get(vaInputs.create_incident);\n\n      var title = {\n            url: gs.getProperty('glide.servlet.uri') + '/' +\n                  gs.getProperty('sn_itsm_va.com.snc.itsm.virtualagent.portal_url') + \n                  '?sys_id=' + incident.sys_id + '&amp;id=ticket&amp;table=incident',\n            label: incident.number\n      };\n\n      var fieldList = ['category', 'assignment_group', 'short_description', 'state'];\n      var cardRenderer = new global.VaRecordCardRenderer(true);\n      var fields = cardRenderer.createFields(fieldList, incident);\n      var html = cardRenderer.renderCard(title, fields);\n      return html;\n})();"}},{"type":"Decision","name":"Decision","branches":[{"type":"Branch","label":"Description Is Not Empty","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return (vaInputs.short_description.getValue().trim() != '');\n})()\n"},"id":"436fdfd78a884c5588e8c6c6ad25e8a9","name":"Description Is Not Empty"},{"type":"Branch","label":"Description Is Empty","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return (vaInputs.short_description.getValue().trim() == '');\n})()\n"},"id":"8d0433f64d394df1b274644eaff045d4","name":"Description Is Empty"}],"id":"227b5883c8984be684aea413ad5e8a2e","goal_id":"23ce83c5e0e048c7826d8f2f4dfd3fe6"},{"type":"ScriptedAction","script":"(function execute() {\n    var incident = new GlideRecord('incident');\n    incident.initialize();\n    incident.caller_id = vaInputs.user;\n    incident.short_description = vaInputs.short_description;\n    incident.urgency = vaInputs.urgency;\n    incident.contact_type = 'virtual_agent';\n    vaInputs.create_incident = incident.insert();\n    return vaInputs.create_incident;\n})();","id":"17026bf8bcf94d6fb0b1f1fb2110e0e9","name":"Create Incident","goal_id":"23ce83c5e0e048c7826d8f2f4dfd3fe6"},{"type":"ReferenceChoiceInputPrompt","mode":"external","id":"b071de2795454a4a8507eb618f4d3476","name":"Urgency","goal_id":"23ce83c5e0e048c7826d8f2f4dfd3fe6","variable_id":"75daa0a8097d4adc8950c8c24e1786dd","message":{"type":"String","mode":"script","value":"(function execute() {\n    if (vaVars.count &gt; 0) {\n        return gs.getMessage('OK, what\\'s the urgency of your issue?');\n    }\n    return gs.getMessage('What\\'s the urgency of your issue?');\n})()"},"optional":false,"expression_mode":"script","script":"(function execute() {\n    var choices = new GlideChoiceList();\n    // Getting all the choices for urgency.\n    var choiceList = choices.getChoiceList('incident', 'urgency');\n    \n    var options = [];\n\n    for (var i=0; i &lt; choiceList.getSize(); i++) {\n        options.push({'value': choiceList.getChoice(i).getValue(), 'label': choiceList.getChoice(i).getLabel()});\n    }\n    \n    return options;    \n})()\n","no_options_found_message":{"type":"String","mode":"string","value":"OK, got it."}}],"edges":[{"type":"Edge","source_node_id":"b071de2795454a4a8507eb618f4d3476","target_node_id":"17026bf8bcf94d6fb0b1f1fb2110e0e9","id":"0e6cdc37955e4948ae3726c3fb04c75a"},{"type":"Edge","source_node_id":"17026bf8bcf94d6fb0b1f1fb2110e0e9","target_node_id":"8d97018a18c04e7c838d64371a3b0be0","id":"ea15cee23a034bbf9a9a52ff0846a624"},{"type":"Edge","source_node_id":"09aea3c778884e73b41e5f758dd41e29","target_node_id":"aa32c52a30c74e7e90a943a52dc1434d","branch_id":"7471736ba6d94461ad0a3e75243c7531","id":"9427ea8ca83d495d9ea4ae6db5c28806","name":"7471736ba6d94461ad0a3e75243c7531"},{"type":"Edge","source_node_id":"e0ffe80c32bb4b79a36c804329175121","target_node_id":"aa32c52a30c74e7e90a943a52dc1434d","id":"76b54b019dd04119aa05c56fd0f8dc55"},{"type":"Edge","source_node_id":"6d719a50025442d89bfc6bcc0ea097f5","target_node_id":"b3c273f4363e4da0bbdae7a4a49260c2","id":"a80aea785aba424dbd91bd3e01f10667"},{"type":"Edge","source_node_id":"a476dd02b50e49f99eb2d68ace202aaf","target_node_id":"dbd8a602ed0240e5aeac72d801953ace","id":"fa22eb2ae7624469a461ac08caa37d10"},{"type":"Edge","source_node_id":"dbd8a602ed0240e5aeac72d801953ace","target_node_id":"42a895b6306548429858417b21d5bf53","branch_id":"4d74334d1f684a9ab56612041aa2bb8b","id":"27b80d2eacfb43deb305973fde96e7ad","name":"4d74334d1f684a9ab56612041aa2bb8b"},{"type":"Edge","source_node_id":"42a895b6306548429858417b21d5bf53","target_node_id":"09aea3c778884e73b41e5f758dd41e29","id":"5f77ebda0f3f4fbc87cb8d619334bf0b"},{"type":"Edge","source_node_id":"09aea3c778884e73b41e5f758dd41e29","target_node_id":"b071de2795454a4a8507eb618f4d3476","branch_id":"64203bf43bfd4c6b92fb4ac2ba15b132","id":"9ce88aa740cf47a7847cc5abfda3d933","name":"64203bf43bfd4c6b92fb4ac2ba15b132"},{"type":"Edge","source_node_id":"8d97018a18c04e7c838d64371a3b0be0","target_node_id":"e0ffe80c32bb4b79a36c804329175121","id":"9297505a89a64bf7ad99b2ced6094651"},{"type":"Edge","source_node_id":"b3c273f4363e4da0bbdae7a4a49260c2","target_node_id":"227b5883c8984be684aea413ad5e8a2e","id":"d91f4cea3e534077a4d4b1841c8d018c"},{"type":"Edge","source_node_id":"227b5883c8984be684aea413ad5e8a2e","target_node_id":"a476dd02b50e49f99eb2d68ace202aaf","branch_id":"436fdfd78a884c5588e8c6c6ad25e8a9","id":"ee9b767c809a4f25a803bf9207f118e7","name":"436fdfd78a884c5588e8c6c6ad25e8a9"},{"type":"Edge","source_node_id":"227b5883c8984be684aea413ad5e8a2e","target_node_id":"b3c273f4363e4da0bbdae7a4a49260c2","branch_id":"8d0433f64d394df1b274644eaff045d4","id":"c8a478f5f05f48a38a673902df684170","name":"8d0433f64d394df1b274644eaff045d4"},{"type":"Edge","source_node_id":"dbd8a602ed0240e5aeac72d801953ace","target_node_id":"b071de2795454a4a8507eb618f4d3476","branch_id":"455a5667c0f944079782b0e7aa5837db","id":"ac3e4d531aa44eb68bee665c353ba832","name":"455a5667c0f944079782b0e7aa5837db"}],"id":"23ce83c5e0e048c7826d8f2f4dfd3fe6"}],"script_variables":[{"type":"String","name":"limit","value":{"type":"String","mode":"string","value":"5"},"id":"18e2eaafa80f4504ac71bf841c795ee6"},{"type":"String","name":"count","value":{"type":"String","mode":"string","value":"0"},"id":"86f0336e413a44a0b32ac745298b47d4"},{"type":"String","name":"LiveAgent_application","value":{"type":"String","mode":"string","value":"itsm"},"id":"78add6caf6a54c07a269f8db47973b49"}],"glide_variables":[{"type":"String","name":"short_description","id":"99259e34c31840c5941daa3fb26ceb8d"},{"type":"True/False","id":"f114636f04cb414c82416778b2432215","name":"is_helpful"},{"type":"Reference","table":"incident","id":"ce65850e646546ed95e300b188c28b1d","name":"create_incident"},{"type":"Choice","choices":[],"id":"75daa0a8097d4adc8950c8c24e1786dd","name":"urgency","table":""}],"applicability":{"type":"Applicability","mode":"script","value":"(function execute() {\n    var gr = new GlideRecord('incident');\n    return gr.canCreate();\n})()\n"},"roles":[],"scope":"134450a0b3781300787162ac16a8dc1e","id":"703538a8db3813005dd0dfea5e9619fc","name":"Open IT Ticket","key_phrases":["create","open","incident","ticket","issue","broken","help","IT"]}</design_definition>
        <design_topic_id>703538a8db3813005dd0dfea5e9619fc</design_topic_id>
        <name>Open IT Ticket</name>
        <sys_class_name>sys_cb_design_topic</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2019-01-24 10:47:37</sys_created_on>
        <sys_domain>global</sys_domain>
        <sys_id>505624404f9f2300209b4a318110c727</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name>FlowTopic</sys_name>
        <sys_package display_value="apdc" source="x_93700_apdc">8472deb0db01230055552bfa4b961970</sys_package>
        <sys_policy/>
        <sys_scope display_value="apdc">8472deb0db01230055552bfa4b961970</sys_scope>
        <sys_update_name>sys_cb_design_topic_505624404f9f2300209b4a318110c727</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2019-01-24 10:47:37</sys_updated_on>
        <type>FlowTopic</type>
    </sys_cb_design_topic>
</record_update>
